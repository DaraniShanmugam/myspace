package model;
//import java.util.*;
//import java.util.Date;
import view.App;
import lib.Note;
import lib.ListItem;
import java.sql.*;

import lib.Database;
import java.util.Date;
public class NotesModel {
	
	public void insert(Note note)
	{
		//String arr[]=new String[100];
		//System.out.println("insert into notes(null,'"+user_id+"',null,'"+content+"',null,now()')");
		//int Id=id.setId();
		int userId=note.getUserId();
		String content=note.getContent();
		ListItem[] list=note.getList();
		String title=note.getTitle();
		if (list==null)
		{
		try {
			
			App.database.executeUpdate("insert into notes values(null,'"+userId+"','"+title+"','"+content+"',null,now())");
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		}
		else
		{
			try {
				App.database.executeUpdate("insert into notes values(null,'"+userId+"','"+title+"','"+content+"','list',now())");
				App.database.execute("select last_insert_id()");
			} catch (SQLException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			ResultSet result=App.database.fetchResult();
			int noteId =0;
			try {
				while(result.next())
				{
					 try {
						noteId=(result.getInt(1));
					} catch (SQLException e) {
						// TODO Auto-generated catch block
						e.printStackTrace();
					}
				}
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			if(noteId != 0)
				insertlist(list,noteId);
		}
	}
		
	
	public void insertlist(ListItem[] list,int noteId)
	{
		 
	     int note_id=noteId;
         for(ListItem item : list)
         {
        	 String content=item.getContent();
             boolean checked=item.getChecked();
		try {
			App.database.executeUpdate("insert into list values('"+note_id+"',null,'"+content+"','"+((checked)?1:0)+"')");
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
         }
	}
          public Note[] fetchEntries()
          {
        	  int count=0;
        	  Note[] note=null;
        	  try {
				App.database.execute("select * from notes");
				note=new Note[App.database.getRowCount()];
				ResultSet result=App.database.fetchResult();
				while(result.next())
				{
					note[count]=new Note();
					note[count].setId(result.getInt("id"));
					note[count].setUserId(result.getInt("userId"));
					note[count].setTitle(result.getString("title"));
					note[count].setContent(result.getString("content"));
					note[count].setTime(result.getDate("time"));
					count++;
					
				}
				
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
        	  return note;
          }
	
	public static void main(String[] args)
	{
		NotesModel n = new NotesModel();
		Note n1=new Note();
		ListItem[] n2=new ListItem[5];
		n2[0] = new ListItem();
		n2[0].setContent("a");
		n2[1] = new ListItem();
		n2[1].setContent("b");
		n2[2] = new ListItem();
		n2[2].setContent("c");
		n2[3] = new ListItem();
		n2[3].setContent("d");
		n2[4] = new ListItem();
		n2[4].setContent("e");
		
		
		
		n1.setContent("java");
		n1.setUserId(1);
		n1.setList(n2);
		try {
			App.database=new Database();
		} catch (ClassNotFoundException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		n.insert(n1);
		System.out.println(n.fetchEntries());
		//n.inserttnotes("database", "hello");
	}
}

